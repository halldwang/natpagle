<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>简介 | JavaScript中的函数式编程</title>
    <meta name="description" content="JavaScript 中的函数式编程">
    
    
    <link rel="preload" href="/natpagle/assets/css/0.styles.704ec6d9.css" as="style"><link rel="preload" href="/natpagle/assets/js/app.b21d4d52.js" as="script"><link rel="preload" href="/natpagle/assets/js/2.793adf42.js" as="script"><link rel="preload" href="/natpagle/assets/js/9.d3b39cee.js" as="script"><link rel="prefetch" href="/natpagle/assets/js/10.bb99e574.js"><link rel="prefetch" href="/natpagle/assets/js/11.8cce9fd8.js"><link rel="prefetch" href="/natpagle/assets/js/12.f3ea115a.js"><link rel="prefetch" href="/natpagle/assets/js/13.fe574bc4.js"><link rel="prefetch" href="/natpagle/assets/js/14.752b3757.js"><link rel="prefetch" href="/natpagle/assets/js/15.6a578eca.js"><link rel="prefetch" href="/natpagle/assets/js/16.44463992.js"><link rel="prefetch" href="/natpagle/assets/js/3.1f46a39d.js"><link rel="prefetch" href="/natpagle/assets/js/4.832153c4.js"><link rel="prefetch" href="/natpagle/assets/js/5.d5389a0e.js"><link rel="prefetch" href="/natpagle/assets/js/6.4fa878bd.js"><link rel="prefetch" href="/natpagle/assets/js/7.e166f63b.js"><link rel="prefetch" href="/natpagle/assets/js/8.de7b36b8.js">
    <link rel="stylesheet" href="/natpagle/assets/css/0.styles.704ec6d9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/natpagle/" class="home-link router-link-active"><!----> <span class="site-name">JavaScript中的函数式编程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/natpagle/" class="nav-link">首页</a></div><div class="nav-item"><a href="/natpagle/book/cover-preface.html" class="nav-link">章节</a></div><div class="nav-item"><a href="/natpagle/book/contribution.html" class="nav-link">贡献内容</a></div> <a href="https://github.com/halldwang/natpagle" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/natpagle/" class="nav-link">首页</a></div><div class="nav-item"><a href="/natpagle/book/cover-preface.html" class="nav-link">章节</a></div><div class="nav-item"><a href="/natpagle/book/contribution.html" class="nav-link">贡献内容</a></div> <a href="https://github.com/halldwang/natpagle" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/natpagle/book/cover-preface.html" class="sidebar-link">章节和目录</a></li><li><a href="/natpagle/book/chapter-first.html" class="sidebar-link">第一章：通过一个案例了解JavaScript语言能力</a></li><li><a href="/natpagle/book/chapter-second.html" class="sidebar-link">第二章：函数式编程基础</a></li><li><a href="/natpagle/book/chapter-third.html" class="sidebar-link">第三章：搭建函数式编程环境</a></li><li><a href="/natpagle/book/chapter-fourth.html" class="active sidebar-link">第四章：JavaScript中的函数式编程实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#函数局部应用和柯里化" class="sidebar-link">函数局部应用和柯里化</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#函数操作" class="sidebar-link">函数操作</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#绑定参数" class="sidebar-link">绑定参数</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#函数工厂" class="sidebar-link">函数工厂</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#局部应用" class="sidebar-link">局部应用</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#柯里化" class="sidebar-link">柯里化</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#函数组合" class="sidebar-link">函数组合</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#主要函数式编程" class="sidebar-link">主要函数式编程</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#事件处理" class="sidebar-link">事件处理</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#响应式函数编程" class="sidebar-link">响应式函数编程</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#综述" class="sidebar-link">综述</a></li><li class="sidebar-sub-header"><a href="/natpagle/book/chapter-fourth.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/natpagle/book/chapter-fifth.html" class="sidebar-link">第五章：理论范畴</a></li><li><a href="/natpagle/book/chapter-sixth.html" class="sidebar-link">第六章：JavaScript中的高级函数和陷阱话题</a></li><li><a href="/natpagle/book/chapter-seventh.html" class="sidebar-link">第七章：JavaScript中的函数式和面向对象编程</a></li><li><a href="/natpagle/book/appendix.html" class="sidebar-link">附录：JavaScript中常用函数的函数式方法</a></li><li><a href="/natpagle/book/contribution.html" class="sidebar-link">贡献内容</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h1> <p>大家现在要集中精力了，因为现在真的要进入实用的编程思维模式了。</p> <p>在本章中，我们将执行以下操作：</p> <ul><li>把所有的核心概念整合成一个连贯的范例</li> <li>当我们完全致力于这种风格时，探索函数式编程所能提供的好处</li> <li>在函数式编程模式相互构建的过程中逐步编写它们的逻辑过程</li> <li>我们将构建一个简单的程序，完成一些非常酷的功能</li></ul> <p>上一章中提出了一些函数式编程概念，但在第 2 章“函数编程的基本原理”中没有提到。那是有原因的！Compositions, currying, partial application，等等。让我们来学习这些库为什么以及如何实现这些概念。</p> <p>函数式编程可以有多种风格和模式。本章将介绍许多不同风格的函数式编程：</p> <ul><li>数据通用编程</li> <li>一般函数式编程</li> <li>响应式函数式编程</li></ul> <p>这一章将尽可能的保持编程风格平和。在不过分依赖一种风格的函数式编程的情况下，总目标是寻找有更好的方法来编写代码，而不是采用唯一的方法。如果你以多种方式来编写代码的先入为主的观念解放编程思想，你就可以做任何你想做的事情。反之，如果你不遵循规律，随意写代码，可能会产生很多问题。</p> <h2 id="函数局部应用和柯里化"><a href="#函数局部应用和柯里化" class="header-anchor">#</a> 函数局部应用和柯里化</h2> <p>许多语言支持可选参数，但在 JavaScript 中不支持。JavaScript 使用完全不同的模式，允许向函数传递任意数量的参数。这就为一些非常有趣和不同寻常的设计模式打开了大门。函数可以部分或全部应用。</p> <p>JavaScript 中的部分应用程序是将值绑定到函数的一个或多个参数的过程，该函数返回另一个接受其余未绑定参数的函数。类似地，curring 是将具有多个参数的函数转换为具有一个参数的函数的过程，该参数返回另一个根据需要接受更多参数的函数。</p> <p>两者之间的区别现在可能还不清楚，但最终会差异很大。</p> <h2 id="函数操作"><a href="#函数操作" class="header-anchor">#</a> 函数操作</h2> <p>实际上，在我们进一步解释如何实现偏函数应用和柯里化之前，我们需要做一个系统回顾。我们要探索 JavaScriptC 语言，暴露它的功能底层，我们需要了解 JavaScript 中的原函数、函数和原型是如何工作的；如果我们只是想设置一些 cookie 或验证一些表单字段，我们就不需要考虑这些。</p> <h3 id="apply、call-和-this-关键字"><a href="#apply、call-和-this-关键字" class="header-anchor">#</a> apply、call 和 this 关键字</h3> <p>在纯函数式语言中，函数不被调用；而是被应用。JavaScript 也以同样的方式工作，甚至提供了手动调用和应用函数的实用程序。这都是关于<code>this</code>关键字的，当然也是函数所属的对象。</p> <p>使用 call()函数可以将 this 关键字定义为第一个参数。 其工作方式如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// normal way</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// using call</span>
</code></pre></div><p>可以使用 call()函数来调用匿名函数:</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>apply()函数与 call()函数非常相似，但更有用：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// won't work for arrays though</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// but this will work</span>
</code></pre></div><p>根本的区别是，尽管 call()函数接受参数列表，而 apply()函数接受参数数组。</p> <p>call()和 apply()函数允许你编写一次函数，然后在其他对象中继承它，而无需再次编写函数。它们都是 Function 参数的成员。</p> <blockquote><p>当你自己使用 call()函数时，可能会发生一些非常有意思的事情：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 两者相等</span>
func<span class="token punctuation">.</span>call（thisValue）<span class="token punctuation">;</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>call<span class="token punctuation">.</span>call（func，thisValue）<span class="token punctuation">;</span>
</code></pre></div><h2 id="绑定参数"><a href="#绑定参数" class="header-anchor">#</a> 绑定参数</h2> <p>bind()函数的作用是：将一个方法应用于一个对象，并将这个 this 关键字分配给另一个对象。在内部，它与 call()函数相同，但它链接到该方法并返回一个新的有界函数。</p> <p>它对于回调特别有用，如下代码片段所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Drum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>noise <span class="token operator">=</span> <span class="token string">&quot;boom&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">goBoom</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> drum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Drum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span>drum<span class="token punctuation">.</span><span class="token function">goBoom</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>drum<span class="token punctuation">)</span><span class="token punctuation">,</span> drum<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这解决了诸如 Dojo.js 之类的面向对象框架中的许多问题，特别是在使用定义自己的处理函数的类时维护状态的问题。 但是我们也可以将 bind()函数用于函数式编程。</p> <h2 id="函数工厂"><a href="#函数工厂" class="header-anchor">#</a> 函数工厂</h2> <p>还记得第二章“函数式编程基础知识”中有关闭包的部分吗？ 闭包是使可以创建有用的 JavaScript 编程模式（称为函数工厂）的构造。 它们允许我们手动将参数绑定到函数。</p> <p>首先，我们需要一个将参数绑定到另一个函数的函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bindFirstArg</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后，我们可以使用它来创建更多通用函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> powersOfTwo <span class="token operator">=</span> <span class="token function">bindFirstArg</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>pow<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">powersOfTwo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">powersOfTwo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 32</span>
</code></pre></div><p>它也可以处理其他参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bindSecondArg</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> squareOf <span class="token operator">=</span> <span class="token function">bindSecondArg</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>pow<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cubeOf <span class="token operator">=</span> <span class="token function">bindSecondArg</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>pow<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">squareOf</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">squareOf</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 16</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">cubeOf</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 27</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">cubeOf</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 64</span>
</code></pre></div><p>创建泛型函数的功能在函数编程中非常重要。 但是，有一个巧妙的技巧可以使此过程更加通用。 bindFirstArg()函数本身带有两个参数，第一个是函数。 如果我们将 bindFirstArg 函数作为函数传递给自身，则可以创建可绑定函数。 可以通过以下示例对此进行最好的描述：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> makePowersOf <span class="token operator">=</span> <span class="token function">bindFirstArg</span><span class="token punctuation">(</span>bindFirstArg<span class="token punctuation">,</span> Math<span class="token punctuation">.</span>pow<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> powersOfThree <span class="token operator">=</span> <span class="token function">makePowersOf</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">powersOfThree</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">powersOfThree</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 27</span>
</code></pre></div><p>这就是为什么它们被称为函数工厂的原因。</p> <h2 id="局部应用"><a href="#局部应用" class="header-anchor">#</a> 局部应用</h2> <p>需要注意的是，我们的函数工厂示例的 bindFirstArg()和 bindSecondArg()函数只适用于只有两个参数的函数。我们可以为不同数量的论据编写新的论据，但这会偏离我们的概括。我们需要的是局部应用。</p> <p>在哪里需要局部应用？</p> <p>与 bind()函数和 Function 对象的其他内置方法不同，我们必须为局部应用和 currying 创建自己的函数。 有两种不同的方法可以做到这一点。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">partial</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span> <span class="token comment">// As a stand-alone function</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">partial</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span> <span class="token comment">// As a polyfill</span>
</code></pre></div><p><code>Polyfill</code>用于增加具有新功能的原型，并允许我们将新功能称为要部分应用的功能的方法。 就像这样：<code>myfunction.partial（arg1，arg2，…）;</code></p> <h3 id="从左侧局部应用"><a href="#从左侧局部应用" class="header-anchor">#</a> 从左侧局部应用</h3> <p>这是 JavaScript 的 apply()和 call()实用程序对我们有用的地方。 让我们看一下 Function 对象的可能的 polyfill：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">partialApply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> func <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如您所见，它通过对参数特殊变量进行切片而起作用。</p> <p>让我们看看在示例中使用它时会发生什么。 这次，让我们远离数学，去做一些有用的事情。 我们将创建一个小的应用程序，将数字转换为十六进制值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">nums2hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">componentToHex</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> hex <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// make sure the return value is 2 digits, i.e. 0c or 12</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hex<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;0&quot;</span> <span class="token operator">+</span> hex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> hex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> componentToHex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// the function works on any number of inputs</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">nums2hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ''</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">nums2hex</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '64c8'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">nums2hex</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '64c8ff007b'</span>
<span class="token comment">// but we can use the partial function to partially apply</span>
<span class="token comment">// arguments, such as the OUI of a mac address</span>
<span class="token keyword">var</span> myOUI <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> getMacAddress <span class="token operator">=</span> nums2hex<span class="token punctuation">.</span><span class="token function">partialApply</span><span class="token punctuation">(</span>myOUI<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getMacAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '7b'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getMacAddress</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// '7b64c8027b420001'</span>
<span class="token comment">// or we can convert rgb values of red only to hexadecimal</span>
<span class="token keyword">var</span> shadesOfRed <span class="token operator">=</span> nums2hex<span class="token punctuation">.</span><span class="token function">partialApply</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">shadesOfRed</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'ff7b00'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">shadesOfRed</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'ff64c8'</span>
</code></pre></div><p>这个例子表明，我们可以部分地将参数应用于泛型函数，并得到一个新的函数。第一个例子是从左到右，这意味着我们只能部分地应用第一个参数（最左边的参数）。</p> <h3 id="从右侧局部应用"><a href="#从右侧局部应用" class="header-anchor">#</a> 从右侧局部应用</h3> <p>为了从右边应用参数，我们可以定义另一个 polyfill。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">partialApplyRight</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> func <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> shadesOfBlue <span class="token operator">=</span> nums2hex<span class="token punctuation">.</span><span class="token function">partialApplyRight</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">shadesOfBlue</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '7b00ff'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">shadesOfBlue</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '64c8ff'</span>
<span class="token keyword">var</span> someShadesOfGreen <span class="token operator">=</span> nums2hex<span class="token punctuation">.</span><span class="token function">partialApplyRight</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">shadesOfGreen</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '7bff00'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">shadesOfGreen</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '64ff00'</span>
</code></pre></div><p>部分应用程序使我们可以采用非常通用的功能，并从中提取更多特定的功能。 但是此方法的最大缺陷是参数传递的方式（以多少和顺序排列）可能是模棱两可的。 在编程中，模棱两可绝不是一件好事。 有一种更好的方法可以做到这一点：柯里化。</p> <h2 id="柯里化"><a href="#柯里化" class="header-anchor">#</a> 柯里化</h2> <p>柯里化是将具有多个参数的函数转换为具有一个参数的函数的过程，该函数返回另一个需要根据需要使用更多参数的函数。 形式上，具有 N 个参数的函数可以转换为 N 个函数的函数链，每个函数只有一个参数。</p> <p>一个常见的问题是：局部应用和柯里化有什么区别？ 的确，局部应用立即返回了一个值，而柯里化仅返回另一个接受下一个参数的柯里化函数，但根本的区别在于柯里可以更好地控制如何将参数传递给函数。 我们将看到这是怎么回事，但是首先我们需要创建函数来执行该计算。</p> <p>这是我们为函数原型添加 curring 的 polyfill：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">curry</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">numArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> func <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  numArgs <span class="token operator">=</span> numArgs <span class="token operator">||</span> func<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token comment">// recursively acquire the arguments</span>
  <span class="token keyword">function</span> <span class="token function">subCurry</span><span class="token punctuation">(</span><span class="token parameter">prev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> args <span class="token operator">=</span> prev<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> numArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// recursive case: we still need more args</span>
        <span class="token keyword">return</span> <span class="token function">subCurry</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// base case: apply the function</span>
        <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">subCurry</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>numArgs 参数使我们可以选择指定未明确定义的函数所需要的参数数量。</p> <p>让我们看看如何在十六进制转化方法中使用它。 编写一个将 RGB 值转换为适合 HTML 的十六进制字符串的函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">rgb2hex</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// nums2hex is previously defined in this chapter</span>
  <span class="token keyword">return</span> <span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> <span class="token function">nums2hex</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">nums2hex</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">nums2hex</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> hexColors <span class="token operator">=</span> rgb2hex<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hexColors</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns a curried function</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hexColors</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns a curried function</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hexColors</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns #0b0c7b</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hexColors</span><span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns #d20c00</span>
</code></pre></div><p>它将返回 curried 函数，直到传递了所有需要的参数为止。它们以与 curryed 函数定义的相同的顺序从左到右传递。</p> <p>但是我们可以将其提高一个级别，并定义我们需要的更具体的功能，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">reds</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">g<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">hexColors</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">greens</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">hexColors</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">blues</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> g</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">hexColors</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">reds</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns #ff0b0c</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">greens</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns #0bff0c</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">blues</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns #0b0cff</span>
</code></pre></div><p>因此，这是使用 currying 的好方法。 但是，如果我们只想直接使用 nums2hex()函数，则会遇到一些麻烦。 因为该函数没有定义任何参数，它只是需要传递尽可能多的参数。 我们必须定义参数的数量。 我们使用 curry 函数的可选参数，该参数允许我们设置正在 curry 函数的参数数量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> hexs <span class="token operator">=</span> nums2hex<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hexs</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 0b0c</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hexs</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns function</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hexs</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// incorrect</span>
</code></pre></div><p>因此，currying 不能与接受可变数量的参数的函数配合使用。 对于这种情况，首选部局部应用。这些不仅是为了函数工厂和代码重用。 柯里化和局部应用会发挥更大的作用，称为函数组合(Function composition)。</p> <h2 id="函数组合"><a href="#函数组合" class="header-anchor">#</a> 函数组合</h2> <p>最后，我们来到了函数组合。</p> <p>在函数式编程中，我们希望一切都成为函数。 如果可能，我们特别希望一元函数。 如果我们可以将所有函数转换为一元函数，那么神奇的事情就会发生。</p> <p><code>一元函数是仅接受单个输入的函数。 具有多个输入的函数是双元函数，但是对于接受两个输入的函数，我们通常说成二进制，对于三个输入的函数，我们通常说成三进制。 某些功能不接受特定数量的输入。 我们称这些为可变参数。</code></p> <p>本小节中，我们将探讨如何从较小的函数组成新的函数：将很小的逻辑单元组合成整个方法，这些逻辑单元大于单独的函数之和。</p> <h3 id="组合"><a href="#组合" class="header-anchor">#</a> 组合</h3> <p>组合函数使我们可以从许多简单的通用函数中构建复杂的函数。 通过将功能视为其他功能的构建块，我们可以构建具有出色可读性和可维护性的真正模块化应用程序。</p> <p>在定义 compose() polyfill 之前，可以通过以下示例了解工作方式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> roundedSqrt <span class="token operator">=</span> Math<span class="token punctuation">.</span>round<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>sqrt<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">roundedSqrt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns: 2</span>

<span class="token keyword">var</span> squaredDate <span class="token operator">=</span> roundedSqrt<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span>parse<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">squaredDate</span><span class="token punctuation">(</span><span class="token string">&quot;January 1, 2014&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns: 1178370</span>
</code></pre></div><p>在数学上，将 f 和 g 变量的组成定义为 f(g(x))。在 JavaScript 中，可以这样写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> g</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如果我们不这样做，除其他问题外，我们将无法找到此关键字。 解决方案是使用 apply()和 call()。 与 curry 相比，compose() polyfill 方式非常简单。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prevFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> nextFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">nextFunc</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">prevFunc</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>为了展示其用法，让我们构建一个完整的示例，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">function1</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> <span class="token string">&quot; 1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">function2</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> b <span class="token operator">+</span> <span class="token string">&quot; 2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">function3</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> c <span class="token operator">+</span> <span class="token string">&quot; 3&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> composition <span class="token operator">=</span> function3<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>function2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>function1<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">composition</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 'count 1 2 3'</span>
</code></pre></div><p>是否注意到首先应用了 function3 参数？ 功能从右到左应用，这个非常重要。</p> <h3 id="反向组合"><a href="#反向组合" class="header-anchor">#</a> 反向组合</h3> <p>因为许多人喜欢从左到右阅读内容，所以按此顺序应用功能也很有意义。 我们称其为序列而不是合成。</p> <p>要颠倒顺序，我们需要做的就是交换<code>nextFunc</code>和<code>prevFunc</code>参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sequence</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prevFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> nextFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">prevFunc</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">nextFunc</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这使我们现在可以更自然地调用函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> sequences <span class="token operator">=</span> function1<span class="token punctuation">.</span><span class="token function">sequence</span><span class="token punctuation">(</span>function2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sequence</span><span class="token punctuation">(</span>function3<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sequences</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 'count 1 2 3'</span>
</code></pre></div><h3 id="组合与链式"><a href="#组合与链式" class="header-anchor">#</a> 组合与链式</h3> <p>这是同一 floorSqrt()函数组成的五个不同实现。 它们似乎是相同的，但值得仔细检查。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">floorSqrt1</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sqrtNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> floorSqrt <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>sqrtNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> stringNum <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>floorSqrt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> stringNum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">floorSqrt2</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">floorSqrt3</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>num<span class="token punctuation">]</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>sqrt<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>floor<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> floorSqrt4 <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>floor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>sqrt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> floorSqrt5 <span class="token operator">=</span> Math<span class="token punctuation">.</span>sqrt<span class="token punctuation">.</span><span class="token function">sequence</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>floor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sequence</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// all functions can be called like this:</span>
floorSqrt <span class="token operator">&lt;</span> <span class="token constant">N</span> <span class="token operator">&gt;</span> <span class="token number">17</span><span class="token punctuation">;</span> <span class="token comment">// Returns: 4</span>
</code></pre></div><p>但有几个关键的区别，我们应该回顾一下：</p> <ul><li>显然，第一种方法冗长且效率低下。</li> <li>第二种方法是很好的一行程序，但是这种方法在只应用了几个函数之后就变得非常不可读了。</li></ul> <p><code>如果说代码越少越好，那就没有意义了。当有效的指令更简洁时，代码更易于维护。如果在不更改执行的有效指令的情况下减少代码字符数，则会导致完全相反的效果：代码变得更难理解，而且不易维护；例如，当我们使用嵌套的三元运算符或将多个命令连在一行上时。这些方法减少了代码量，但并没有减少该代码实际指定的步骤的数量。因此，这样做的结果是混淆并使代码更难理解。使代码更易于维护的一种简洁性是，它有效地减少了指定的指令（例如，通过使用更简单的算法，用更少和/或更简单的步骤来实现相同的结果），或者当我们简单地用消息替换代码时，例如，用有良好文档记录的API调用第三方库。</code></p> <ul><li>第三种方法是一系列数组函数，尤其是 map 函数。 这样写没问题，但在数学上不正确。</li> <li>这是我们正在使用的 compose()函数。所有方法都必须是一元的纯函数，这些函数鼓励使用更好，更简单和更小的函数来完成一件事并做好。</li> <li>最后一种方法反向组合使用 compose()函数，同样有效。</li></ul> <h3 id="组合编程"><a href="#组合编程" class="header-anchor">#</a> 组合编程</h3> <p>compose 最重要的是，除了应用的第一个函数外，它还与纯一元函数（仅接受一个参数的函数）一起使用效果最佳。</p> <p>所应用的第一个功能的输出将发送到下一个功能。 这意味着该函数必须接受先前传递给它的函数。 这是类型签名背后的主要影响。</p> <p><code>类型签名用于显式声明函数接受的输入类型和输出的类型。最初由Haskell使用，Haskell实际上在编译器要使用的函数定义中使用它们。但是，在JavaScript中，我们只是将它们放在代码注释中。它们看起来像这样：foo :: arg1 -&gt; argN -&gt; output</code></p> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// getStringLength :: String -&gt; Int</span>
<span class="token keyword">function</span> <span class="token function">getStringLength</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> s<span class="token punctuation">.</span>length<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// concatDates :: Date -&gt; Date -&gt; [Date]</span>
<span class="token keyword">function</span> <span class="token function">concatDates</span><span class="token punctuation">(</span><span class="token parameter">d1<span class="token punctuation">,</span>d2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">[</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// pureFunc :: (int -&gt; Bool) -&gt; [int] -&gt; [int]</span>
<span class="token function">pureFunc</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre></div><p>为了真正获得 compose 的好处，任何应用程序都需要大量的一元、纯函数集合。这些是组成更大功能的构建块，反过来，这些功能又用于使应用程序非常模块化、可靠和可维护。</p> <p>让我们举个例子。首先，我们需要许多构建块函数。其中一些建立在其他基础之上，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// stringToArray :: String -&gt; [Char]</span>
<span class="token keyword">function</span> <span class="token function">stringToArray</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// arrayToString :: [Char] -&gt; String</span>
<span class="token keyword">function</span> <span class="token function">arrayToString</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// nextChar :: Char -&gt; Char</span>
<span class="token keyword">function</span> <span class="token function">nextChar</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// previousChar :: Char -&gt; Char</span>
<span class="token keyword">function</span> <span class="token function">previousChar</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// higherColorHex :: Char -&gt; Char</span>
<span class="token keyword">function</span> <span class="token function">higherColorHex</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> c <span class="token operator">&gt;=</span> <span class="token string">&quot;f&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;f&quot;</span> <span class="token punctuation">:</span> c <span class="token operator">==</span> <span class="token string">&quot;9&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">:</span> <span class="token function">nextChar</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// lowerColorHex :: Char -&gt; Char</span>
<span class="token keyword">function</span> <span class="token function">lowerColorHex</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> c <span class="token operator">&lt;=</span> <span class="token string">&quot;0&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">:</span> c <span class="token operator">==</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;9&quot;</span> <span class="token punctuation">:</span> <span class="token function">previousChar</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// raiseColorHexes :: String -&gt; String</span>
<span class="token keyword">function</span> <span class="token function">raiseColorHexes</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>higherColorHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// lowerColorHexes :: String -&gt; String</span>
<span class="token keyword">function</span> <span class="token function">lowerColorHexes</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>lowerColorHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>让我们把它们组合在一起。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> lighterColor <span class="token operator">=</span> arrayToString
  <span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>raiseColorHexes<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>stringToArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> darkerColor <span class="token operator">=</span> arrayToString<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>lowerColorHexes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>stringToArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">lighterColor</span><span class="token punctuation">(</span><span class="token string">&quot;af0189&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns: 'bf129a'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">darkerColor</span><span class="token punctuation">(</span><span class="token string">&quot;af0189&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns: '9e0078'</span>
</code></pre></div><p>我们甚至可以一起使用 compose（）和 curry（）函数。 实际上，他们在一起工作得很好。 让我们将 curry 示例与我们的 compose 示例结合在一起。 首先，我们需要以前的帮助程序功能。</p> <p>我们甚至可以同时使用 compose()和 curry()函数。它们搭配使用效果很好。让我们将 curry 示例与我们的 compose 示例结合在一起。我们需要上上小结的函数方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// component2hex :: Ints -&gt; Int</span>
<span class="token keyword">function</span> <span class="token function">componentToHex</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> hex <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> hex<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;0&quot;</span> <span class="token operator">+</span> hex <span class="token punctuation">:</span> hex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// nums2hex :: Ints* -&gt; Int</span>
<span class="token keyword">function</span> <span class="token function">nums2hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> componentToHex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们创建柯里函数和部分应用的函数，然后将它们组合到其他组合函数中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> lighterColors <span class="token operator">=</span> lighterColor<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>nums2hex<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> darkerRed <span class="token operator">=</span> darkerColor<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>nums2hex<span class="token punctuation">.</span><span class="token function">partialApply</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> lighterRgb2hex <span class="token operator">=</span> lighterColor<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>nums2hex<span class="token punctuation">.</span><span class="token function">partialApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">lighterColors</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns: 8cff11</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">darkerRed</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns: ee6a00</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">lighterRgb2hex</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns: 8cd975</span>
</code></pre></div><p>以上函数整体不错。我们从一件事的小功能开始。然后我们就可以把功能组合在一起了。</p> <p>让我们看最后一个例子。 这是一个可将可变值的 RGB 值变亮的函数。 然后，我们可以使用组合从中创建新功能。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lighterColorNumSteps :: string -&gt; num -&gt; string</span>
<span class="token keyword">function</span> <span class="token function">lighterColorNumSteps</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    color <span class="token operator">=</span> <span class="token function">lighterColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// now we can create functions like this:</span>
<span class="token keyword">var</span> lighterRedNumSteps <span class="token operator">=</span> lighterColorNumSteps<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>reds<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// and use them like this:</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">lighterRedNumSteps</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Return: 'ff5555'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">lighterRedNumSteps</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Return: 'ff2222'</span>
</code></pre></div><p>同样，我们可以轻松创建更多功能，以创建更浅和更深的蓝色，绿色，灰色，紫色或任何想要的颜色。 这是构造 API 的绝佳方法。</p> <p>我们只是勉强了解函数组合可以做什么。 compose 所做的是从 JavaScript 中夺走控制权。 通常，JavaScript 将从左到右求值，但是现在解释器会说“好吧，其他的事情会处理好的，我就转到下一个。”现在 compose()函数可以控制序列求值了！</p> <p>这就是 Lazy.js，Bacon.js 和其他人能够实现诸如惰性求值和无限序列之类的方式的方式。 接下来，我们将研究如何使用这些库。</p> <h2 id="主要函数式编程"><a href="#主要函数式编程" class="header-anchor">#</a> 主要函数式编程</h2> <p>什么是没有副作用的程序？答案是：一个什么也不做的程序。</p> <p>用具有不可避免的副作用的函数式代码来补充我们的代码可以称为“主要函数式编程”。在同一个代码库中使用多个范例并在它们最理想的地方应用它们是最好的方法。大多数情况下，函数式编程是建模纯传统函数式程序的方式：：将大部分逻辑保持在纯函数中，并与命令式代码接口。</p> <p>这就是我们要编写自己的：‘a little application’编程方式。</p> <p>在这个例子中，我们有一个老板告诉我们，我们需要一个用于跟踪员工可用性状态的 web 应用程序。这家虚构公司的所有员工只有一个工作：使用我们的网站。员工上班时会签到，离开时会签退。但这还不够，它还需要随着内容的变化自动更新内容，因此我们的老板不必不断刷新页面。</p> <p>我们将使用 Lazy.js 作为我们的功能库：我们不必假装要处理所有登录和注销的用户，WebSocket，数据库等等，而是假装有一个通用应用程序对象为我们完成此任务的完美 API。</p> <p>所以现在，让我们把丑陋的部分，界面和创造副作用的部分去掉。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Receptor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> available</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>available <span class="token operator">=</span> available<span class="token punctuation">;</span> <span class="token comment">// mutable state</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    output <span class="token operator">=</span> <span class="token string">&quot;&lt;li&gt;&quot;</span><span class="token punctuation">;</span>
    output <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>available
      <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; is available&quot;</span>
      <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; is not available&quot;</span><span class="token punctuation">;</span>
    output <span class="token operator">+=</span> <span class="token string">&quot;&lt;/li&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> output<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> me <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Receptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> receptors <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getReceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> receptors
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>仅显示可用性列表就足够了，但我们希望它是反响应式的，这会给我们带来第一个难点。</p> <p>通过使用 Lazy.js 库按顺序存储对象（在调用 toArray()方法之前它实际上不会计算任何东西），我们可以利用其惰性求值来提供一种功能性的响应式编程。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> lazyReceptors <span class="token operator">=</span> <span class="token function">Lazy</span><span class="token punctuation">(</span>receptors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>因为 Receptor.render()方法返回新的 HTML 而不是修改当前 HTML，所以我们要做的就是将 innerHTML 参数设置为其输出。</p> <p>用于用户管理的通用应用程序将提供回调方法供我们使用。</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function-variable function">onUserLogin</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>available <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span>container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function-variable function">onUserLogout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>available <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span>container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这样，用户每次登录或注销时，都会再次计算 lazyReceptors 参数，并且将使用最新值打印可用性列表。</p> <h2 id="事件处理"><a href="#事件处理" class="header-anchor">#</a> 事件处理</h2> <p>如果应用程序不提供用户登录和注销时的回调该怎么办？ 回调很混乱，代码就变成了面条式代码。相反，我们可以通过直接观察用户来确定它。如果用户的网页处于焦点位置，则他/她必须处于活动状态且可用。我们可以使用 JavaScript 的 focus 和 blur 事件。</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;focus&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  me<span class="token punctuation">.</span>available <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">setReceptor</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>name<span class="token punctuation">,</span> me<span class="token punctuation">.</span>available<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// just go with it</span>
  container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;blur&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  me<span class="token punctuation">.</span>available <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">setReceptor</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>name<span class="token punctuation">,</span> me<span class="token punctuation">.</span>available<span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>等一下，事件不是也有响应式吗？ 也可以惰性计算它们吗？ 在 Lazy.js 库中，甚至有一个方便的方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> focusedReceptors <span class="token operator">=</span> Lazy<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">&quot;focus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  me<span class="token punctuation">.</span>available <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">setReceptor</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>name<span class="token punctuation">,</span> me<span class="token punctuation">.</span>available<span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blurredReceptors <span class="token operator">=</span> Lazy<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">&quot;blur&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  me<span class="token punctuation">.</span>available <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">setReceptor</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>name<span class="token punctuation">,</span> me<span class="token punctuation">.</span>available<span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以上非常简单。</p> <p><code>通过使用Lazy.js库处理事件，我们可以创建无限个事件序列。 每次触发事件时，Lazy.each()函数都可以迭代一次。</code></p> <p>到目前为止，我们的老板很喜欢这个应用程序，但他指出，如果一名员工在离开前一天没有关闭页面就从不注销，那么该应用程序会记录该员工仍然工作。</p> <p>为了确定某个员工是否在网站上处于活动状态，我们可以监视键盘和鼠标事件。假设他们被认为在 30 分钟没有活动之后就不可用了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> inputs <span class="token operator">=</span> Lazy<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  me<span class="token punctuation">.</span>available <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    me<span class="token punctuation">.</span>available <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> lazyReceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1800000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 30 minutes</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Lazy.js 库使我们很容易将事件处理为可以映射的无限流。它之所以能够做到这一点，是因为它使用函数组合来控制执行顺序。</p> <p>但这一切都有点问题。如果没有可以锁定的用户输入事件呢？如果有一个属性值一直在变化呢？在下一节中，我们将详细分析这个问题。</p> <h2 id="响应式函数编程"><a href="#响应式函数编程" class="header-anchor">#</a> 响应式函数编程</h2> <p>让我们来构建另一种几乎相同的应用程序。一种使用函数式编程对状态变化做出响应的程序。但是，这一次，应用程序将无法依赖事件侦听器。</p> <p>想象一下，你在一家新闻媒体公司工作，老板让你开发一个 web 页面，这个应用可以跟踪选举日的政府选举结果。。当本地区域提交结果时，数据不断流入，因此要显示在页面上的结果非常活跃。但我们还需要按每个区域跟踪结果，因此将有多个对象要跟踪。</p> <p>与其创建一个面向对象的层次结构来对接口建模，不如将其声明性地描述为不可变数据。我们可以用纯函数和半纯函数链来转换它，它们的唯一最终副作用是更新绝对必须保持的任何状态位（理想情况下，不是很多）。</p> <p>我们将使用 Bacon.js 库，该库将能够快速开发响应式函数编程（FRP）应用程序。该应用程序仅在一年中的某一天（选举日）使用，而我们的老板认为应该花相应的时间。借助函数式编程和 Bacon.js 等之类的库，我们将在预期一半的时间完成它。</p> <p>首先，我们需要一些对象来代表投票区域，比如州、省、区等等。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Region</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> percent<span class="token punctuation">,</span> parties</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// mutable properties:</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>percent <span class="token operator">=</span> percent<span class="token punctuation">;</span> <span class="token comment">// % of precincts reported</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>parties <span class="token operator">=</span> parties<span class="token punctuation">;</span> <span class="token comment">// political parties</span>
  <span class="token comment">// return an HTML representation</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> lis <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parties<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;&lt;li&gt;&quot;</span> <span class="token operator">+</span> p<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> p<span class="token punctuation">.</span>votes <span class="token operator">+</span> <span class="token string">&quot;&lt;/li&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> output <span class="token operator">=</span> <span class="token string">&quot;&lt;h2&gt;&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;&lt;/h2&gt;&quot;</span><span class="token punctuation">;</span>
    output <span class="token operator">+=</span> <span class="token string">&quot;&lt;ul&gt;&quot;</span> <span class="token operator">+</span> lis<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/ul&gt;&quot;</span><span class="token punctuation">;</span>
    output <span class="token operator">+=</span> <span class="token string">&quot;Percent reported: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>percent<span class="token punctuation">;</span>
    <span class="token keyword">return</span> output<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getRegions</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>percent<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>parties<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;http://api.server.com/election-data?format=json&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> regions <span class="token operator">=</span> <span class="token function">getRegions</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> regions
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>尽管以上内容仅显示静态的选举结果列表就足够了，但我们需要一种动态更新区域的方法。 Bacon.js 和响应式函数编程就派上用场了。</p> <h3 id="响应式"><a href="#响应式" class="header-anchor">#</a> 响应式</h3> <p>Bacon.js 具有一个函数 Bacon.fromPoll()，该函数可让我们创建事件流，该事件只是在给定间隔上调用的函数和流。 subscription()函数使我们可以向流订阅一个处理函数。 因为是惰性的，所以没有订阅者，流实际上不会做任何事情。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> eventStream <span class="token operator">=</span> Bacon<span class="token punctuation">.</span><span class="token function">fromPoll</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Bacon<span class="token punctuation">.</span>Next<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> subscriber <span class="token operator">=</span> eventStream<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;http://api.server.com/election-data?format=json&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> newRegions <span class="token operator">=</span> <span class="token function">getRegions</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> newRegions
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过基本上将其置于每 10 秒运行一次的循环中，我们可以完成工作。 但是这种方法会反复请求，效率极低。不是最佳的解决方案，我们应该更深入研究 Bacon.js 库。</p> <p>在 Bacon 中，有<code>EventStreams</code>和<code>Properties</code>参数。属性可以被认为是变量，随着时间的推移会随着事件的变化而变化。因为它们仍然依赖一系列事件，属性相对于其 EventStream 随时间变化。</p> <p>Bacon.js 库还有另外一个技巧。 Bacon.fromPromise()函数是一种使用 Promise 将事件发送到流中的方法。 jQuery1.5.0 版开始，jQuery AJAX 实现了 promises 接口。 因此，我们需要做的就是编写一个 AJAX 搜索函数，该函数在异步调用完成时发出事件。 每当 Promise 被执行时，它都会调用 EvenStream 的订阅。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;http://api.server.com/election-data?format=json&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> eventStream <span class="token operator">=</span> Bacon<span class="token punctuation">.</span><span class="token function">fromPromise</span><span class="token punctuation">(</span>jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> subscriber <span class="token operator">=</span> eventStream<span class="token punctuation">.</span><span class="token function">onValue</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  newRegions <span class="token operator">=</span> <span class="token function">getRegions</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

  container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> newRegions
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Promise 可以被视为最终的求值。 使用 Bacon.js 库，我们只需要关注等待最终值。</p> <h2 id="综述"><a href="#综述" class="header-anchor">#</a> 综述</h2> <p>既然我们已经讨论了响应式，我们终于可以实现一些方法了。</p> <p>我们可以使用纯函数链来修改订阅，以完成计算和过滤不需要的结果等操作，并且可以在创建 onclick()时处理函数中为创建的按钮进行（和完成）所有操作。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// create the eventStream out side of the functions</span>
<span class="token keyword">var</span> eventStream <span class="token operator">=</span> Bacon<span class="token punctuation">.</span><span class="token function">onPromise</span><span class="token punctuation">(</span>jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> subscribe <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;http://api.server.com/election-data?format=json&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// our un-modified subscriber</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;button#showAll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> subscriber <span class="token operator">=</span> eventStream<span class="token punctuation">.</span><span class="token function">onValue</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newRegions <span class="token operator">=</span> <span class="token function">getRegions</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>name<span class="token punctuation">,</span> r<span class="token punctuation">.</span>percent<span class="token punctuation">,</span> r<span class="token punctuation">.</span>parties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> newRegions
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// a button for showing the total votes</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;button#showTotal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> subscriber <span class="token operator">=</span> eventStream<span class="token punctuation">.</span><span class="token function">onValue</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> emptyRegion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token string">&quot;empty&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">&quot;Republican&quot;</span><span class="token punctuation">,</span>
        votes<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">&quot;Democrat&quot;</span><span class="token punctuation">,</span>
        votes<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> totalRegions <span class="token operator">=</span> <span class="token function">getRegions</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r1<span class="token punctuation">,</span> r2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newParties <span class="token operator">=</span> r1<span class="token punctuation">.</span>parties<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> r1<span class="token punctuation">.</span>parties<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          votes<span class="token punctuation">:</span> r1<span class="token punctuation">.</span>parties<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>votes <span class="token operator">+</span> r2<span class="token punctuation">.</span>parties<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>votes
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      newRegion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Total&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>r1<span class="token punctuation">.</span>percent <span class="token operator">+</span> r2<span class="token punctuation">.</span>percent<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
        newParties
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> newRegion<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> emptyRegion<span class="token punctuation">)</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> totalRegions<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// a button for only displaying regions that are reporting &gt; 50%</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;button#showMostlyReported&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> subscriber <span class="token operator">=</span> eventStream<span class="token punctuation">.</span><span class="token function">onValue</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newRegions <span class="token operator">=</span> <span class="token function">getRegions</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>percent <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">return</span> r<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> r <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> newRegions
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样做的好处是，当用户在几个按钮之间点击时，事件流不会更改，而订阅者会更改，这使所有操作都顺利进行。</p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>JavaScript是一门优美的语言</p> <p>它的内在美真正在函数式编程中大放异彩。它给JavaScript赋予了它卓越的可扩展性，它允许一级函数可以做很多事情，这样方法彼此叠加，功能越来越强大。</p> <p>在本章中，我们首先学习JavaScript的函数范式。 我们介绍了函数工厂，柯里化，函数组成和函数正常运行所需。 我们构建了一个模块化方法。 然后，展示了如何使用一些功能库，这些函数库本身使用这些相同的概念，即函数组合，来控制执行顺序。</p> <p>在本章中，我们讨论了函数式编程的几种类型：数据流范型编程，主要是函数式编程和函数响应式式编程。它们之间并没有什么不同，它们只是在不同的情况下应用函数式编程的不同模式。</p> <p>在前一章中，我们简要地提到了理论范畴。在下一章中，我们将学习更多关于它是什么以及如何使用它的知识。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/halldwang/natpagle/edit/master/docs/book/chapter-fourth.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/26/2019, 11:53:45 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/natpagle/book/chapter-third.html" class="prev">第三章：搭建函数式编程环境</a></span> <span class="next"><a href="/natpagle/book/chapter-fifth.html">第五章：理论范畴</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/natpagle/assets/js/app.b21d4d52.js" defer></script><script src="/natpagle/assets/js/2.793adf42.js" defer></script><script src="/natpagle/assets/js/9.d3b39cee.js" defer></script>
    <script type="text/javascript">
     var _mtac = {};
     (function() {
       var mta = document.createElement("script");
       mta.src = "//pingjs.qq.com/h5/stats.js?v2.0.4";
       mta.setAttribute("name", "MTAH5");
       mta.setAttribute("sid", "500706003");
       var s = document.getElementsByTagName("script")[0];
       s.parentNode.insertBefore(mta, s);
     })();
    </script>
  </body>
</html>
